:PROPERTIES:
:ID:       44CF80E3-73D7-4784-B90D-99A61E951D0F
:END:
#+TITLE: dstc11复盘文档
#+AUTHOR: Jun Gao
#+DATE: [2022-10-27 四 15:19]
#+HUGO_BASE_DIR: ~/notes
#+HUGO_SECTION: ch/docs

* 规则临时修改
** DONE 9.27 submission instrction 邮件确认去掉了intent limit 50 规则
CLOSED: [2022-10-27 四 16:32]
** TODO 确认对最终结果的影响
* 确认提交结果版本
** DONE 把提交结果和本地的对比
CLOSED: [2022-10-27 四 16:32]
* 测试集确认算法问题
** DONE 重新跑现有的提交结果
CLOSED: [2022-11-03 四 15:01]
** 对比重跑的结果和本地的结果
** TODO 用官方的测试集验证指标
结果公布：https://docs.google.com/spreadsheets/d/15K3vBDfAj_fzqK988rrESRuk4MTgyIOKIarKGZpGja4/edit#gid=92075029
| data      | baseline | origin dialog act |  规则筛选 | simcse | ground truth |
|-----------+----------+-------------------+-----------+--------+--------------|
| insurance |     60.2 |                   |      70.4 |   81.3 |         87.6 |
| banking   |    70.76 |                   |      59.2 |   63.6 |         73.2 |
| finance   |    56.46 | ～47.8            |    43.5?     |   55.5 |              |

*** 把dstc11-track2-intent-induction/sitod/experiment.py:238
#+begin_src python
        target = "induced_intents_gzq_sccl_res_roformer_1912_28_epoch40_bs24.jsonl"
        intent_schema = read_intents("/nfs/volume-242-2/gaojun/dstc11/dstc11-track2-intent-induction/dstc11_gzq/"+target)
#+end_src
改成banking
#+begin_src python
        intent_schema = read_intents("/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/induced-intents-banking_n1705_k21remove888.json")
#+end_src
或finance
#+begin_src python
        intent_schema = read_intents("/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/induced-intents-finance_n2636_k24remove777.json")
#+end_src
*** dstc11-track2-intent-induction/configs/run-open-intent-induction-baselines-adj.jsonnet:35改为test-banking或test-finance
*** copy文件夹到dstc11-track2-intent-induction/dstc11下
*** 运行
#+begin_src shell
python3 -m sitod.run_experiment \
--data_root_dir dstc11 \
--experiment_root_dir results \
--config configs/run-open-intent-induction-baselines-adj.jsonnet
#+end_src
acc
banking 63.6 符合
finance 55.3 符合
** 用官方测试集验证其他结果
*** 没加simcse的版本
**** 第一次提交
文件路径
banking [fn:3]
finance [fn:4]
acc
banking 33.7 低于预期
finance 47.2 低于预期
**** 重新复现
***** baseline algorithm data
banking
***** 1503 1597 ground truth 无simcse
|         | 原始文件 | 结果文件 |  acc |  k |                    |
|---------+----------+----------+------+----+--------------------|
| banking | [fn:5]   | [fn:7]   | 73.2 | 22 | 相比于baseline偏低 |
| finance | [fn:6]   | [fn:8]   |      | 24 |                    |

***** 1256 2285 dingning
|         | 原始文件 | 结果文件 | acc   |  k |          |
|---------+----------+----------+-------+----+----------|
| banking |          | [fn:9]   | 59.2  | 22 | 低于预期 |
| finance |          |          | 43.5? | 24 |          |

*** 没有限制50条的版本
|         | 原始文件 | 结果文件 |  acc |  k |         |
|---------+----------+----------+------+----+---------|
| banking |          | [fn:10]  | 65.6 | 22 | 提升2   |
| finance |          | [fn:11]  | 55.5 | 24 | 提升0.2 |

*** k=28 simcse 限制50
banking /Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/induced-intents-banking_n1705_k22remove.json acc63.1
** k值影响
*** banking
**** TODO origin nosimcse file
| k   | 22 |   25 |   30 | 35 | 40 | 45 | 50 |
|-----+----+------+------+----+----+----+----|
| acc |    |      |      |    |    |    |    |
**** statistic nosimcse file
| k   |   22 |   25 |   30 |   35 |   40 |   45 | 50 |
|-----+------+------+------+------+------+------+----|
| acc | 59.2 | 72.2 | 71.7 | 75.2 | 78.6 | 74.2 | 72 |
**** TODO statistic simcse file
| k   |   22 | 25 | 30 | 35 | 40 | 45 | 50 |
|-----+------+----+----+----+----+----+----|
| acc | 63.6 |    |    |    |    |    |    |
**** 对比结果
#+begin_src python :results file :exports results
    import numpy, matplotlib
    matplotlib.use('Agg')
    import matplotlib.pyplot as plt

    x = [22]+[i for i in range(25,51,5)]
    y = [59.2,72.2,71.7,75.2,78.6,74.2,72]
    plt.plot(x,y,label="no simcse")
    y_pred = [p+4.4 for p in y]
    plt.plot(x,y_pred,'y--',label="simcse pred")
    plt.scatter(26,88.7,label='1st')
    plt.scatter(35,79,label='2nd')
    plt.scatter(42,78,label='3rd')
    plt.scatter(22,64,label='ours')
    plt.legend(loc="best")
  #  fig.tight_layout()
    plt.savefig('1.png')
    return('1.png')
#+end_src

#+RESULTS:
[[file:1.png]]

*** finance
**** finance origin6676 nosimcse 文件路径[fn:2]
#+NAME: f-o-n
| k   | 24 |   25 |   30 |   35 |   40 | 45 | 50 |
|-----+----+------+------+------+------+----+----|
| acc |    | 47.8 | 45.5 | 48.1 | 41.2 | 50.4 |    |
**** ONGOING finance statistic nosimcse 文件路径 [fn:1]
?
| statistic | 24 | 25 | 30 | 35 | 40 | 45 |   50 |
|-----------+----+----+----+----+----+----+------|
| acc       |    |    |    |    |    |    |      |
**** ONGOING finance statistic simcse 文件路径
#+NAME: citas-data
| k   | 24(55.5) |   25 | 30 |   35 |   40 | 45 |   50 |
|-----+----------+------+----+------+------+----+------|
| acc |       57 | 60.5 | 67 | 69.4 | 69.6 | 75 | 73.4 |
**** 对比结果

#+begin_src python :results file :var tbl_data=citas-data tbl_data2=f-o-n :exports results
  import numpy, matplotlib
  # matplotlib.use('Agg')
  import matplotlib.pyplot as plt
  fig = plt.figure()
  x = [24]+[i for i in range(25,51,5)]
  # y = [57,60.5,67,69.4,69.6,75,73.4]
  y = tbl_data[0][1:]
  origin = tbl_data2[0][1:]
  # origin = [0,47.8,45.5,48.1,41.2,50.4,0]
  plt.plot(x,y,'y',label="ours:SCCL+statistic+simcse")
  plt.plot(x[1:-1],origin[1:-1],'b',label="SCCL origin baseline")
  plt.scatter(43,72.39,label='1st')
  plt.scatter(42,71.5,label='2nd/3rd')
  plt.scatter(36,71.33,label='4th')
  plt.scatter(40,71.15,label='5th')
  plt.scatter(51,65.66,label='7th')
  plt.scatter(24,55,label='ours:submit')
  plt.xlabel("k")
  plt.ylabel("acc/%")
  plt.title("result of finance")
  plt.legend(loc="best")
  # fig.tight_layout()
  plt.savefig('2.png')
  return('2.png')
#+end_src

#+RESULTS:
[[file:2.png]]
* dstc11文件梳理
** dstc_final_code 梽强哥准备的用于提交的代码
** dstc11-track2-intent-induction 用于insurance的代码
** FINAL-dstc11-track2-intent-induction 用于banking和clinc的代码
** FINAL-dstc11-track2-intent-induction-dingning

* Footnotes

[fn:11]/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/induced-intents-finance_k24_n2636.json
[fn:10]/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/induced-intents-banking_n1705_k22.json

[fn:9]/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/after_d_induced-intents-banking22_1256_50_24.json
[fn:8]/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/after_induced-intents-finance_n1597_k24.json

[fn:7]/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/after_induced-intents-banking20_1705_50_24.json
[fn:6]/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/dstc11/development/test-finance/dialogues_ground_truth_1597.jsonl

[fn:5]/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/dstc11/development/test-banking/dialogues_ground_truth_1503.jsonl
[fn:4]/Users/didi/Desktop/dstc11/dstc11-track2-intent-induction/dstc11_gzq/induced_intents_finance_gzq_sccl_res_2285_28_epoch30_bs24.jsonl

[fn:3]/Users/didi/Desktop/dstc11/dstc11-track2-intent-induction/dstc11_gzq/induced_intents_banking_gzq_sccl_res_1256_27_epoch30_bs24.jsonl
[fn:2]file:/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/after_origin_induced-intents-finance_n6676_k25.json

[fn:1]file:/Users/didi/Desktop/dstc11/FINAL-dstc11-track2-intent-induction/final_result/after_d_induced-intents-finance_n1597_k50.json
